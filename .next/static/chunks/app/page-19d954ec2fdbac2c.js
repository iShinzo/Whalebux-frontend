(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{8368:(e,t,r)=>{Promise.resolve().then(r.bind(r,9107))},9107:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>j});var s=r(5155),a=r(2115);let l=r(9509).env.NEXT_PUBLIC_API_URL||"https://whalebux-vercel.onrender.com/api";console.log("API_BASE_URL:",l);let n=!0,o=async()=>{try{let e="".concat(l.replace(/\/api$/,""),"/health");console.log("Checking backend health at:",e);let t=await fetch(e,{method:"GET",headers:{"Content-Type":"application/json"},cache:"no-store",mode:"cors"});if(console.log("Health check response:",t.status,t.statusText),t.ok){let e=await t.json();console.log("Health check data:",e)}return n=t.ok}catch(e){return console.error("Backend health check failed:",e),n=!1,!1}},i=async()=>{try{console.log("Testing CORS with backend...");let e=await fetch("".concat(l.replace(/\/api$/,""),"/cors/test"),{method:"GET",headers:{"Content-Type":"application/json"},mode:"cors"});if(console.log("CORS test response status:",e.status),!e.ok)return console.error("CORS test failed:",e.statusText),!1;{let t=await e.json();return console.log("CORS test successful:",t),!0}}catch(e){return console.error("CORS test error:",e),!1}};o().then(e=>console.log("Backend is ".concat(e?"available":"unavailable"))).catch(e=>console.error("Error checking backend availability:",e)),i().then(e=>console.log("CORS test ".concat(e?"passed":"failed"))).catch(e=>console.error("Error during CORS test:",e));let c={getUserData:async e=>{try{n||await o();let t="".concat(l,"/users/").concat(e);console.log("Fetching user data from:",t);let r=await fetch(t,{headers:{"Content-Type":"application/json"},cache:"no-store",mode:"cors"});if(console.log("User data response:",r.status,r.statusText),!r.ok)throw Error("Failed to fetch user data: ".concat(r.status," ").concat(r.statusText));let s=await r.json();return console.log("User data received:",s),s}catch(e){throw console.error("Error fetching user data:",e),e}},createUser:async e=>{try{n||await o(),console.log("Creating user with data:",e),console.log("API URL being used:","".concat(l,"/users"));let t=await fetch("".concat(l,"/users"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e),mode:"cors"});if(console.log("Create user response status:",t.status,t.statusText),!t.ok){let e=await t.text();throw console.error("Error response body:",e),Error("Failed to create user: ".concat(t.status," ").concat(t.statusText," - ").concat(e))}let r=await t.json();return console.log("User created successfully:",r),r}catch(e){throw console.error("Error creating user:",e),e instanceof Error&&(console.error("Error message:",e.message),console.error("Error stack:",e.stack)),e}}},d={getTasksForUser:async e=>{try{n||await o();let t=await fetch("".concat(l,"/tasks?userId=").concat(e),{headers:{"Content-Type":"application/json"},cache:"no-store",mode:"cors"});if(!t.ok)throw Error("Failed to fetch tasks: ".concat(t.statusText));return await t.json()}catch(e){return console.error("Error fetching tasks:",e),[]}},completeTask:async(e,t)=>{try{n||await o();let r=await fetch("".concat(l,"/tasks/").concat(e,"/complete"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:t}),mode:"cors"});if(!r.ok)throw Error("Failed to complete task: ".concat(r.statusText));return await r.json()}catch(e){throw console.error("Error completing task:",e),e}}};function m(){let[e,t]=(0,a.useState)(null),[r,s]=(0,a.useState)(null),[l,n]=(0,a.useState)(!0),[o,i]=(0,a.useState)(null);return(0,a.useEffect)(()=>{(async()=>{try{var e,r;if(console.log("Initializing Telegram WebApp..."),console.log("Window object:","object"),console.log("Telegram object:",typeof window.Telegram),console.log("WebApp object:",null===(e=window.Telegram)||void 0===e?void 0:e.WebApp),null===(r=window.Telegram)||void 0===r?void 0:r.WebApp){console.log("Telegram WebApp found, initializing..."),window.Telegram.WebApp.ready(),window.Telegram.WebApp.expand();let e=window.Telegram.WebApp.initDataUnsafe;if(e&&e.user){console.log("User data from Telegram:",e.user);let t=e.user.id;try{let e=await c.getUserData(t);console.log("User data from API:",e),s(e)}catch(r){if(console.error("Error fetching user data:",r),r instanceof Error&&(r.message.includes("404")||r.message.includes("not found"))){console.log("Creating new user...");try{console.log("Attempting to create user with telegramId:",t),console.log("User data to be sent:",{telegramId:t,username:e.user.username||"user_".concat(t),firstName:e.user.first_name||"",lastName:e.user.last_name||""});let r=await c.createUser({telegramId:t,username:e.user.username||"user_".concat(t),firstName:e.user.first_name||"",lastName:e.user.last_name||""});console.log("New user created successfully:",r),s(r)}catch(e){console.error("Error creating user in telegram-init:",e),console.error("Error type:",typeof e),console.error("Error details:",e instanceof Error?e.message:String(e)),i("Failed to create user account: ".concat(e instanceof Error?e.message:String(e)))}}else i("Failed to fetch user data: ".concat(r instanceof Error?r.message:String(r)))}}else console.warn("No user data in Telegram WebApp initDataUnsafe"),i("No user data available from Telegram");t(window.Telegram.WebApp)}else console.warn("Telegram WebApp not found. Are you opening this app from within Telegram?"),i("Not running inside Telegram")}catch(e){console.error("Error initializing Telegram WebApp:",e),i("Initialization error: ".concat(e instanceof Error?e.message:String(e)))}finally{n(!1)}})()},[]),{webApp:e,user:r,loading:l,error:o}}var u=r(5453),h=r(6786);let g=(0,u.v)()((0,h.Zr)((e,t)=>({userId:null,telegramId:null,username:null,firstName:null,lastName:null,level:1,experience:0,wbuxDollars:0,wbuxBalance:0,loginStreak:1,referralCode:null,referralCount:0,referredBy:null,lastLogin:null,miningRateLevel:1,miningBoostLevel:1,miningTimeLevel:1,nftSlotLevel:0,completedTasks:[],friends:[],referralBoost:0,setUser:t=>e(e=>({...e,...t})),incrementLoginStreak:()=>e(e=>({...e,loginStreak:e.loginStreak+1})),resetLoginStreak:()=>e(e=>({...e,loginStreak:1})),addFriend:t=>e(e=>({...e,friends:[...e.friends,t]})),updateFriend:(t,r)=>e(e=>({...e,friends:e.friends.map(e=>e.telegramId===t?{...e,...r}:e)})),removeFriend:t=>e(e=>({...e,friends:e.friends.filter(e=>e.telegramId!==t)})),updateReferralBoost:()=>{let r=t().friends.filter(e=>e.isActive&&Date.now()-new Date(e.lastActive).getTime()<864e5).length,s=0;r>=20?s=25:r>=10?s=15:r>=5?s=10:r>=1&&(s=5),e({referralBoost:s})},clearUser:()=>e({userId:null,telegramId:null,username:null,firstName:null,lastName:null,level:1,experience:0,wbuxDollars:0,wbuxBalance:0,loginStreak:1,referralCode:null,referralCount:0,referredBy:null,lastLogin:null,miningRateLevel:1,miningBoostLevel:1,miningTimeLevel:1,nftSlotLevel:0,completedTasks:[],friends:[],referralBoost:0})}),{name:"whalebux-user-storage"}));var x=r(6874),p=r.n(x),f=r(9509);let b=()=>{let{webApp:e,user:t,loading:r,error:l}=m(),[n,o]=(0,a.useState)([]),[i,u]=(0,a.useState)(!0),h=g(e=>e.setUser),x=g(e=>e.referralBoost);return((0,a.useEffect)(()=>{t&&t.telegramId&&(h({userId:t.userId,telegramId:t.telegramId,username:t.username,firstName:t.firstName,lastName:t.lastName,level:t.level,experience:t.experience,wbuxDollars:t.wbuxDollars,wbuxBalance:t.wbuxBalance,loginStreak:t.loginStreak,referralCode:t.referralCode,referralCount:t.referralCount,lastLogin:t.lastLogin,miningRateLevel:t.miningRateLevel,miningBoostLevel:t.miningBoostLevel,miningTimeLevel:t.miningTimeLevel,nftSlotLevel:t.nftSlotLevel,completedTasks:t.completedTasks||[]}),d.getTasksForUser(t.telegramId).then(e=>{o(e),u(!1)}).catch(e=>{console.error("Error fetching tasks:",e),u(!1)}))},[t,h]),r)?(0,s.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,s.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})}):l||!t?(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center min-h-screen p-4",children:[(0,s.jsx)("h1",{className:"text-3xl font-bold text-white mb-4",children:"Error"}),(0,s.jsx)("p",{className:"text-white mb-4",children:l||"Could not authenticate with Telegram. Please try again."}),(0,s.jsxs)("div",{className:"bg-gray-800 rounded-lg p-4 w-full max-w-md mb-4",children:[(0,s.jsx)("h2",{className:"text-xl font-bold text-white mb-2",children:"Debug Information"}),(0,s.jsxs)("p",{className:"text-gray-400 text-sm",children:["API URL: ",f.env.NEXT_PUBLIC_API_URL||"Not set"]}),(0,s.jsxs)("p",{className:"text-gray-400 text-sm",children:["Environment: ","production"]}),(0,s.jsxs)("p",{className:"text-gray-400 text-sm",children:["Telegram WebApp: ",e?"Available":"Not Available"]})]}),(0,s.jsx)("a",{href:"/test",className:"mt-4 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Go to Test Mode"})]}):(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center min-h-screen p-4",children:[(0,s.jsx)("h1",{className:"text-3xl font-bold text-white mb-4",children:"Welcome to WhaleBux!"}),(0,s.jsxs)("div",{className:"bg-gray-800 rounded-lg p-4 w-full max-w-md mb-4",children:[(0,s.jsx)("h2",{className:"text-xl font-bold text-white mb-2",children:"Your Profile"}),(0,s.jsxs)("p",{className:"text-white",children:["Level: ",t.level]}),(0,s.jsxs)("p",{className:"text-white",children:["WhaleBux Dollars: ",t.wbuxDollars]}),(0,s.jsxs)("p",{className:"text-white",children:["WBUX Tokens: ",t.wbuxBalance]}),(0,s.jsxs)("p",{className:"text-white",children:["Referral Code: ",t.referralCode]}),(0,s.jsx)("div",{className:"mt-4 pt-4 border-t border-gray-700",children:(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-white",children:"Mining Center"}),(0,s.jsx)("p",{className:"text-gray-400 text-sm",children:"Earn WhaleBux Dollars by mining!"})]}),(0,s.jsx)(p(),{href:"/mining",className:"px-3 py-1 bg-green-600 text-white rounded hover:bg-green-700",children:"Start Mining"})]})}),(0,s.jsx)("div",{className:"mt-4 pt-4 border-t border-gray-700",children:(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("p",{className:"text-white",children:["Login Streak: ",t.loginStreak," days"]}),(0,s.jsx)("p",{className:"text-gray-400 text-sm",children:"Keep logging in daily for rewards!"})]}),(0,s.jsx)(p(),{href:"/daily-streak",className:"px-3 py-1 bg-blue-600 text-white rounded hover:bg-blue-700",children:"View Streak"})]})}),(0,s.jsx)("div",{className:"mt-4 pt-4 border-t border-gray-700",children:(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("p",{className:"text-white",children:["Referral Boost: +",x,"%"]}),(0,s.jsx)("p",{className:"text-gray-400 text-sm",children:"Invite friends to earn more!"})]}),(0,s.jsx)(p(),{href:"/friends",className:"px-3 py-1 bg-blue-600 text-white rounded hover:bg-blue-700",children:"Invite Friends"})]})}),(0,s.jsx)("div",{className:"mt-4 pt-4 border-t border-gray-700",children:(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-white",children:"Task Marketplace"}),(0,s.jsx)("p",{className:"text-gray-400 text-sm",children:"Complete tasks to earn rewards!"})]}),(0,s.jsx)(p(),{href:"/tasks",className:"px-3 py-1 bg-blue-600 text-white rounded hover:bg-blue-700",children:"View Tasks"})]})}),(0,s.jsx)("div",{className:"mt-4 pt-4 border-t border-gray-700",children:(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-white",children:"NFT Marketplace"}),(0,s.jsx)("p",{className:"text-gray-400 text-sm",children:"Buy, sell, and activate NFT boosts!"})]}),(0,s.jsx)(p(),{href:"/nft",className:"px-3 py-1 bg-blue-600 text-white rounded hover:bg-blue-700",children:"View NFTs"})]})}),(0,s.jsx)("div",{className:"mt-4 pt-4 border-t border-gray-700",children:(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-white",children:"Token Swap"}),(0,s.jsx)("p",{className:"text-gray-400 text-sm",children:"Convert Dollars to WBUX Tokens!"})]}),(0,s.jsx)(p(),{href:"/swap",className:"px-3 py-1 bg-blue-600 text-white rounded hover:bg-blue-700",children:"Swap Tokens"})]})})]}),(0,s.jsxs)("div",{className:"bg-gray-800 rounded-lg p-4 w-full max-w-md",children:[(0,s.jsx)("h2",{className:"text-xl font-bold text-white mb-2",children:"Tasks"}),i?(0,s.jsx)("div",{className:"flex justify-center p-4",children:(0,s.jsx)("div",{className:"animate-spin rounded-full h-6 w-6 border-t-2 border-b-2 border-blue-500"})}):n.length>0?(0,s.jsx)("ul",{className:"space-y-2",children:n.map(e=>(0,s.jsxs)("li",{className:"bg-gray-700 rounded p-3",children:[(0,s.jsx)("h3",{className:"font-bold text-white",children:e.title}),(0,s.jsx)("p",{className:"text-gray-300 text-sm",children:e.description}),(0,s.jsxs)("div",{className:"flex justify-between items-center mt-2",children:[(0,s.jsxs)("span",{className:"text-green-400",children:[e.reward," ","DOLLARS"===e.rewardType?"Dollars":"Tokens"]}),(0,s.jsx)("button",{className:"px-3 py-1 rounded ".concat(e.completed?"bg-gray-600 text-gray-400 cursor-not-allowed":"bg-blue-600 text-white hover:bg-blue-700"),disabled:e.completed,onClick:()=>{!e.completed&&t.telegramId&&d.completeTask(e.id,t.telegramId).then(r=>{r.success&&(o(n.map(t=>t.id===e.id?{...t,completed:!0}:t)),c.getUserData(t.telegramId).then(e=>{h({wbuxDollars:e.wbuxDollars,wbuxBalance:e.wbuxBalance,completedTasks:e.completedTasks||[]})}))}).catch(e=>{console.error("Error completing task:",e)})},children:e.completed?"Completed":"Complete"})]})]},e.id))}):(0,s.jsx)("p",{className:"text-white text-center",children:"No tasks available"})]})]})};var w=r(9509);function j(){let e=m();if((0,a.useEffect)(()=>{var e;console.log("Page component mounted"),console.log("Environment:","production"),console.log("API URL:",w.env.NEXT_PUBLIC_API_URL),(null===(e=window.Telegram)||void 0===e?void 0:e.WebApp)?console.log("Running inside Telegram WebApp"):console.log("Not running inside Telegram WebApp")},[]),!e)return(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center min-h-screen p-4",children:[(0,s.jsx)("h1",{className:"text-3xl font-bold text-white mb-4",children:"WhaleBux"}),(0,s.jsx)("p",{className:"text-white mb-4",children:"This app is designed to run inside Telegram."}),(0,s.jsx)("p",{className:"text-white mb-4",children:"Please open it from your Telegram bot."}),(0,s.jsx)("button",{className:"mt-4 px-4 py-2 bg-blue-600 text-white rounded-lg",onClick:()=>{window.location.href="/?forceLoad=true"},children:"Load App Anyway (Development Only)"})]});let t=window.location.search.includes("forceLoad=true")||!1;return e||t?(0,s.jsx)(b,{}):(0,s.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,s.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})})}}},e=>{var t=t=>e(e.s=t);e.O(0,[817,441,684,358],()=>t(8368)),_N_E=e.O()}]);